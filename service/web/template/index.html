<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hello World</title>
  
  <!-- ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
  <!-- ì½”ë“œ í•˜ì´ë¼ì´íŒ…ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  
  <style>
    /* ê¸°ë³¸ ë§ˆì§„, íŒ¨ë”© ì œê±° ë° ì „ì²´ ë†’ì´ ì„¤ì • */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    /* ì „ì²´ ë ˆì´ì•„ì›ƒì„ ì»¬ëŸ¼ ë°©í–¥ì˜ flex ì»¨í…Œì´ë„ˆë¡œ êµ¬ì„± */
    body {
      display: flex;
      flex-direction: column;
      height: 100dvh; /* ğŸ”¹ ëª¨ë°”ì¼ì—ì„œ ë†’ì´ ë¬¸ì œ í•´ê²° (ë™ì  ë†’ì´) */
    }

    /* í¸ì§‘ëª¨ë“œ ìŠ¤íƒ€ì¼ */
    body.edit-mode {
      cursor: crosshair !important;
    }

    body.edit-mode * {
      cursor: crosshair !important;
    }

    /* í¸ì§‘ëª¨ë“œ í‘œì‹œê¸° */
    .edit-mode-indicator {
      position: fixed;
      top: 10px;
      right: 10px;
      background: #ff4444;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 12px;
      font-weight: bold;
      z-index: 1000;
      display: none;
    }

    body.edit-mode .edit-mode-indicator {
      display: block;
    }

    /* íƒ‘ ì˜ì—­ */
    #top {
      height: 35px;
      border: 1px solid black;
      padding: 10px;
      font-size: 20px;
      color: gray;
      font-weight: bold;
    }

    /* ì¤‘ì•™ ì˜ì—­ */
    #middle {
      flex: 1;
      display: flex;
      overflow: hidden; /* ë„˜ì¹˜ëŠ” ìš”ì†Œ ë°©ì§€ */
    }

    /* ì™¼ìª½ ì˜ì—­ */
    #left {
      width: 10px;
      background: #bbb;
      border: 1px solid black;
    }

    /* ì˜¤ë¥¸ìª½ ì˜ì—­ */
    #right {
      flex: 1;
      border: 1px solid black;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    /* ì´ˆê¸° ë©”ì‹œì§€ ì˜ì—­ */
    #right .int-content {
      height: 30px;
      overflow: hidden;
      padding: 10px;
      font-size: 16px;
      color: #333;
      background-color: #f9f9f9;
      border-bottom: 1px solid #ccc;
    }

    /* ì±„íŒ… ë‚´ìš©ì´ í‘œì‹œë  ì˜ì—­ */
    #right .content {
      flex-grow: 1; /* ë‚¨ì€ ê³µê°„ ëª¨ë‘ ì°¨ì§€ */
      overflow-y: auto;
      padding: 10px;
      font-size: 16px;
      color: #333;
    }

    /* ì…ë ¥ì°½ ì˜ì—­ */
    #right .input-container {
      height: 70px;
      display: flex;
      align-items: center;
      border-top: 1px solid #ccc;
      padding: 5px;
      background: white;
      flex-shrink: 0; /* í¬ê¸°ê°€ ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ ì„¤ì • */
    }

    /* ì…ë ¥ì°½ ìŠ¤íƒ€ì¼ */
    #right .input-container textarea {
      flex: 1;
      resize: none;
      padding: 5px;
      font-size: 14px;
    }

    /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    #right .input-container button {
      margin-left: 5px;
      padding: 5px 10px;
      font-size: 14px;
      cursor: pointer;
      align-self: stretch;
    }

    /* ë°”í…€ ì˜ì—­ */
    #bottom {
      height: 30px;
      padding-left: 10px;
      border: 1px solid black;
    }

    .question {
      margin-top: 10px;
      color: #333;
      font-weight: bold;
      background-color: #f2f2f2;
      padding: 10px;
      border-radius: 1em;
      display: inline-block;
      max-width: 80%;
      word-wrap: break-word;
    }
    
    .answer {
      margin-top: 10px;
      margin-left: 20px;
      color: black;
      white-space: normal; /* ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ì„ ìœ„í•´ ë³€ê²½ */
      margin-bottom: 25px;
      line-height: 1.6;
    }

    /* ë§ˆí¬ë‹¤ìš´ ìŠ¤íƒ€ì¼ë§ */
    .answer h1, .answer h2, .answer h3, .answer h4, .answer h5, .answer h6 {
      margin: 1em 0 0.5em 0;
      color: #333;
      font-weight: bold;
    }

    .answer h1 { font-size: 1.5em; border-bottom: 2px solid #eee; padding-bottom: 0.3em; }
    .answer h2 { font-size: 1.3em; border-bottom: 1px solid #eee; padding-bottom: 0.3em; }
    .answer h3 { font-size: 1.1em; }

    .answer p {
      margin: 0.8em 0;
    }

    .answer ul, .answer ol {
      margin: 0.8em 0;
      padding-left: 2em;
    }

    .answer li {
      margin: 0.3em 0;
    }

    .answer blockquote {
      border-left: 4px solid #ddd;
      margin: 1em 0;
      padding: 0.5em 1em;
      background-color: #f9f9f9;
      color: #666;
    }

    .answer code {
      background-color: #f4f4f4;
      border-radius: 3px;
      padding: 2px 4px;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 0.9em;
      color: #d63384;
    }

    .answer pre {
      background-color: #f8f8f8;
      border: 1px solid #e1e4e8;
      border-radius: 6px;
      padding: 16px;
      overflow-x: auto;
      margin: 1em 0;
    }

    .answer pre code {
      background-color: transparent;
      padding: 0;
      color: inherit;
    }

    .answer table {
      border-collapse: collapse;
      width: 100%;
      margin: 1em 0;
    }

    .answer th, .answer td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }

    .answer th {
      background-color: #f2f2f2;
      font-weight: bold;
    }

    .answer strong {
      font-weight: bold;
      color: #333;
    }

    .answer em {
      font-style: italic;
    }

    .answer a {
      color: #0066cc;
      text-decoration: none;
    }

    .answer a:hover {
      text-decoration: underline;
    }

    .answer hr {
      border: none;
      border-top: 1px solid #ddd;
      margin: 2em 0;
    }

    /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    .modal {
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 500px;
      max-height: 80%;
      overflow-y: auto;
      position: relative;
    }

    .close {
      position: absolute;
      right: 15px;
      top: 10px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      color: #aaa;
    }

    .close:hover {
      color: black;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    .form-group input, .form-group select, .form-group textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }

    .file-info {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }

    .progress-bar {
      width: 100%;
      height: 20px;
      background-color: #f0f0f0;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 10px;
    }

    .progress-fill {
      height: 100%;
      background-color: #4CAF50;
      transition: width 0.3s ease;
      width: 0%;
    }

    .progress-text {
      text-align: center;
      font-size: 14px;
      color: #666;
    }

    /* ì—…ë¡œë“œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    #upload-button, #text-upload-button {
      margin-left: 5px;
      padding: 5px 10px;
      font-size: 16px;
      cursor: pointer;
      border: 1px solid #ccc;
      background: #f9f9f9;
      border-radius: 4px;
    }

    #upload-button:hover, #text-upload-button:hover {
      background: #e9e9e9;
    }

    /* ì„±ê³µ/ì—ëŸ¬ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
    .success-message {
      background-color: #d4edda;
      color: #155724;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      border: 1px solid #c3e6cb;
    }

    .error-message {
      background-color: #f8d7da;
      color: #721c24;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      border: 1px solid #f5c6cb;
    }
  </style>
</head>
<body>
  <!-- í¸ì§‘ëª¨ë“œ í‘œì‹œê¸° -->
  <div class="edit-mode-indicator">í¸ì§‘ ëª¨ë“œ (Rí‚¤ë¡œ í•´ì œ)</div>
  
  <div id="top">ILJoo Deep Hub</div>
  <div id="middle">
    <div id="left"></div>
    <div id="right">
      <div class="int-content">
        {{ message }}
      </div>
      <div class="content" id="content-area"></div>
      <div class="input-container">
        <textarea id="input-text" rows="3" placeholder="í…ìŠ¤íŠ¸ ì…ë ¥..."></textarea>
        <button id="go-button">Go</button>
        <button id="upload-button">ğŸ“</button>
      </div>
      
      <!-- íŒŒì¼ ì—…ë¡œë“œ ëª¨ë‹¬ -->
      <div id="upload-modal" class="modal" style="display: none;">
        <div class="modal-content">
          <span class="close">&times;</span>
          <h3>ğŸ“ ë¬¸ì„œ ì—…ë¡œë“œ ë° ì¸ë±ì‹± (ë©”ëª¨ë¦¬ ê¸°ë°˜)</h3>
          <div class="memory-warning" style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; margin: 10px 0; border-radius: 5px;">
            <strong>âš ï¸ íœ˜ë°œì„± ë©”ëª¨ë¦¬ ì €ì¥:</strong> ì—…ë¡œë“œëœ íŒŒì¼ì€ ë©”ëª¨ë¦¬ì—ë§Œ ì €ì¥ë˜ë©°, í”„ë¡œê·¸ë¨ ì¢…ë£Œ ì‹œ ìë™ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.
          </div>
          <form id="upload-form" enctype="multipart/form-data">
            <div class="form-group">
              <label>íŒŒì¼ ì„ íƒ:</label>
              <input type="file" id="file-input" accept=".pdf,.txt,.docx,.md" required>
              <div class="file-info">ì§€ì› í˜•ì‹: PDF, TXT, DOCX, MD (íœ˜ë°œì„± ì €ì¥)</div>
            </div>
            <button type="submit">ë©”ëª¨ë¦¬ ì—…ë¡œë“œ ë° ì¸ë±ì‹±</button>
          </form>
          <div id="upload-progress" style="display: none;">
            <div class="progress-bar">
              <div class="progress-fill"></div>
            </div>
            <div class="progress-text">ì—…ë¡œë“œ ì¤‘...</div>
          </div>
        </div>
      </div>

    </div>
  </div>
  <div id="bottom">ILJOO GnS </div>

  <script>
    // === ë§ˆí¬ë‹¤ìš´ ì„¤ì • ë° í•¨ìˆ˜ ===
    
    // marked.js ì„¤ì •
    marked.setOptions({
      highlight: function(code, lang) {
        if (lang && hljs.getLanguage(lang)) {
          return hljs.highlight(code, { language: lang }).value;
        } else {
          return hljs.highlightAuto(code).value;
        }
      },
      breaks: true,
      gfm: true
    });

    // ë§ˆí¬ë‹¤ìš´ì„ HTMLë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
    function renderMarkdown(text) {
      try {
        return marked.parse(text);
      } catch (error) {
        console.error('ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ ì˜¤ë¥˜:', error);
        return text.replace(/\n/g, '<br>'); // í´ë°±: ì¤„ë°”ê¿ˆë§Œ ì²˜ë¦¬
      }
    }

    // íƒ€ì´í•‘ íš¨ê³¼ì™€ í•¨ê»˜ ë§ˆí¬ë‹¤ìš´ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
    function typeMarkdownText(element, markdownText, speed = 30) {
      let currentIndex = 0;
      const chunks = markdownText.split('');
      let currentText = '';
      
      const typeInterval = setInterval(() => {
        if (currentIndex < chunks.length) {
          currentText += chunks[currentIndex];
          element.innerHTML = renderMarkdown(currentText);
          
          // ì½”ë“œ í•˜ì´ë¼ì´íŒ… ì ìš©
          element.querySelectorAll('pre code').forEach((block) => {
            hljs.highlightElement(block);
          });
          
          currentIndex++;
        } else {
          clearInterval(typeInterval);
          // ìµœì¢… ë Œë”ë§ ë° í•˜ì´ë¼ì´íŒ…
          element.innerHTML = renderMarkdown(markdownText);
          element.querySelectorAll('pre code').forEach((block) => {
            hljs.highlightElement(block);
          });
        }
      }, speed);
      
      return typeInterval;
    }

    // === í¸ì§‘ ëª¨ë“œ ê´€ë¦¬ ===

    // í¸ì§‘ëª¨ë“œ ìƒíƒœ ê´€ë¦¬
    let isEditMode = false;

    function toggleEditMode() {
      isEditMode = !isEditMode;
      if (isEditMode) {
        document.body.classList.add('edit-mode');
        console.log('í¸ì§‘ëª¨ë“œ í™œì„±í™”');
      } else {
        document.body.classList.remove('edit-mode');
        console.log('í¸ì§‘ëª¨ë“œ ë¹„í™œì„±í™”');
      }
    }

    function adjustHeight() {
      const vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë†’ì´ ì¡°ì •
    window.addEventListener('load', adjustHeight);
    // í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œ ë†’ì´ ì¡°ì •
    window.addEventListener('resize', adjustHeight);

    // ì „ì—­ í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (í¸ì§‘ëª¨ë“œ ì œì–´)
    document.addEventListener('keydown', function(e) {
      // R í‚¤ë¡œ í¸ì§‘ëª¨ë“œ í† ê¸€ (ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ìŒ)
      if (e.key === 'r' || e.key === 'R') {
        // ì…ë ¥ì°½ì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥ ì¤‘ì¸ ê²½ìš°ëŠ” ì œì™¸
        if (document.activeElement.tagName !== 'TEXTAREA' && document.activeElement.tagName !== 'INPUT') {
          e.preventDefault();
          toggleEditMode();
        }
      }
      
      // í¸ì§‘ëª¨ë“œì¼ ë•Œ R í‚¤ ì™¸ì˜ ëª¨ë“  í‚¤ ì…ë ¥ ì°¨ë‹¨
      if (isEditMode) {
        if (e.key !== 'r' && e.key !== 'R') {
          e.preventDefault();
          e.stopPropagation();
          return false;
        }
      }
    });

    // ëª¨ë“  í´ë¦­, ë§ˆìš°ìŠ¤, í‚¤ë³´ë“œ ì´ë²¤íŠ¸ì—ì„œ í¸ì§‘ëª¨ë“œ ì²´í¬
    document.addEventListener('click', function(e) {
      if (isEditMode) {
        e.preventDefault();
        e.stopPropagation();
        return false;
      }
    });

    document.addEventListener('mousedown', function(e) {
      if (isEditMode) {
        e.preventDefault();
        e.stopPropagation();
        return false;
      }
    });

    document.addEventListener('keyup', function(e) {
      if (isEditMode && e.key !== 'r' && e.key !== 'R') {
        e.preventDefault();
        e.stopPropagation();
        return false;
      }
    });

    // í¼ ì œì¶œ ë°©ì§€
    document.addEventListener('submit', function(e) {
      if (isEditMode) {
        e.preventDefault();
        e.stopPropagation();
        return false;
      }
    });

    document.getElementById('go-button').addEventListener('click', function() {
      if (isEditMode) return; // í¸ì§‘ëª¨ë“œì—ì„œëŠ” ë™ì‘í•˜ì§€ ì•ŠìŒ
      
      const inputTextElement = document.getElementById('input-text');
      const inputText = inputTextElement.value.trim();
      if (!inputText) return;

      const contentDiv = document.querySelector('.content');

      // ì§ˆë¬¸ ì¶”ê°€
      const qaEntry = document.createElement('div');
      qaEntry.innerHTML = `<div class="question">${inputText}</div>`;
      contentDiv.appendChild(qaEntry);

      // ì…ë ¥ì°½ ì´ˆê¸°í™”
      inputTextElement.value = '';

      fetch('/ask', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ question: inputText })
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('ë„¤íŠ¸ì›Œí¬ ì‘ë‹µì´ ì •ìƒì´ ì•„ë‹™ë‹ˆë‹¤.');
        }
        return response.json();
      })
      .then(data => {
        // ë‹µë³€ ì¶”ê°€
        const answerDiv = document.createElement('div');
        answerDiv.className = "answer";
        answerDiv.innerHTML = "";
        
        // í’ˆì§ˆ ì ìˆ˜ í‘œì‹œ (ìƒë‹¨ì—)
        const qualityScoreDiv = document.createElement('div');
        qualityScoreDiv.style.cssText = `
          background-color: ${data.quality_score >= 8 ? '#d4edda' : data.quality_score >= 6 ? '#fff3cd' : '#f8d7da'};
          color: ${data.quality_score >= 8 ? '#155724' : data.quality_score >= 6 ? '#856404' : '#721c24'};
          padding: 5px 10px;
          border-radius: 5px;
          font-size: 12px;
          margin-bottom: 10px;
          border: 1px solid ${data.quality_score >= 8 ? '#c3e6cb' : data.quality_score >= 6 ? '#ffeaa7' : '#f5c6cb'};
        `;
        qualityScoreDiv.innerHTML = `
          â­ GPT-4.1 í’ˆì§ˆí‰ê°€: <strong>${data.quality_score.toFixed(1)}/10</strong> | 
          ğŸ“š ì¶œì²˜: <strong>${data.sources.length}</strong>ê°œ ë¬¸ì„œ
        `;
        answerDiv.appendChild(qualityScoreDiv);
        
        const answerContentDiv = document.createElement('div');
        answerContentDiv.className = "answer-content";
        answerDiv.appendChild(answerContentDiv);
        qaEntry.appendChild(answerDiv);

        // ë§ˆí¬ë‹¤ìš´ íƒ€ì´í•‘ íš¨ê³¼ ì ìš©
        const answerText = data.answer;
        typeMarkdownText(answerContentDiv, answerText, 30);

        // ìƒˆ ë©”ì‹œì§€ ì¶”ê°€ ì‹œ ìë™ ìŠ¤í¬ë¡¤ (íƒ€ì´í•‘ ì§„í–‰ ì¤‘ì—ë„)
        const scrollInterval = setInterval(() => {
          contentDiv.scrollTop = contentDiv.scrollHeight;
        }, 100);
        
        // íƒ€ì´í•‘ ì™„ë£Œ í›„ ìŠ¤í¬ë¡¤ ì¸í„°ë²Œ ì •ë¦¬
        setTimeout(() => {
          clearInterval(scrollInterval);
          contentDiv.scrollTop = contentDiv.scrollHeight;
        }, answerText.length * 30 + 1000);
      })
      .catch(error => {
        console.error('ì—ëŸ¬ ë°œìƒ:', error);
      });
    });

    // Enter í‚¤ ì´ë²¤íŠ¸ ì¶”ê°€ (Go ë²„íŠ¼ í´ë¦­ê³¼ ë™ì¼í•œ ë™ì‘)
    document.getElementById('input-text').addEventListener('keydown', function(e) {
      if (isEditMode) return; // í¸ì§‘ëª¨ë“œì—ì„œëŠ” ë™ì‘í•˜ì§€ ì•ŠìŒ
      
      if (e.key === 'Enter' && !e.shiftKey) { 
        e.preventDefault();
        document.getElementById('go-button').click();
      }
    });

    // === ë¬¸ì„œ ì—…ë¡œë“œ ê¸°ëŠ¥ ===
    
    // ëª¨ë‹¬ ê´€ë¦¬
    const uploadModal = document.getElementById('upload-modal');
    const uploadButton = document.getElementById('upload-button');
    const closeBtns = document.querySelectorAll('.close');

    // íŒŒì¼ ì—…ë¡œë“œ ëª¨ë‹¬ ì—´ê¸°
    uploadButton.addEventListener('click', function() {
      if (isEditMode) return;
      uploadModal.style.display = 'flex';
    });

    // ëª¨ë‹¬ ë‹«ê¸°
    closeBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        uploadModal.style.display = 'none';
      });
    });

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    window.addEventListener('click', function(e) {
      if (e.target === uploadModal) {
        uploadModal.style.display = 'none';
      }
    });

    // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
    document.getElementById('upload-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const fileInput = document.getElementById('file-input');
      const progressDiv = document.getElementById('upload-progress');
      const progressFill = document.querySelector('.progress-fill');
      const progressText = document.querySelector('.progress-text');
      
      if (!fileInput.files[0]) {
        alert('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // ì§„í–‰ ìƒí™© í‘œì‹œ
      progressDiv.style.display = 'block';
      progressFill.style.width = '20%';
      progressText.textContent = 'íŒŒì¼ ì—…ë¡œë“œ ì¤‘...';
      
      const formData = new FormData();
      formData.append('file', fileInput.files[0]);
      
      try {
        progressFill.style.width = '50%';
        progressText.textContent = 'ì„œë²„ë¡œ ì „ì†¡ ì¤‘...';
        
        const response = await fetch('/admin/upload-document', {
          method: 'POST',
          body: formData
        });
        
        progressFill.style.width = '80%';
        progressText.textContent = 'ì¸ë±ì‹± ì¤‘...';
        
        const result = await response.json();
        
        progressFill.style.width = '100%';
        
        if (result.success) {
          progressText.textContent = 'ì™„ë£Œ!';
          
          // ì„±ê³µ ë©”ì‹œì§€ë¥¼ ì±„íŒ… ì˜ì—­ì— í‘œì‹œ
          const contentDiv = document.querySelector('.content');
          const messageDiv = document.createElement('div');
          messageDiv.className = 'success-message';
          messageDiv.innerHTML = renderMarkdown(`âœ… ${result.message}`);
          contentDiv.appendChild(messageDiv);
          contentDiv.scrollTop = contentDiv.scrollHeight;
          
          // í¼ ì´ˆê¸°í™”
          fileInput.value = '';
          
          setTimeout(() => {
            uploadModal.style.display = 'none';
            progressDiv.style.display = 'none';
            progressFill.style.width = '0%';
          }, 2000);
          
        } else {
          throw new Error(result.message);
        }
        
      } catch (error) {
        progressDiv.style.display = 'none';
        
        // ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì±„íŒ… ì˜ì—­ì— í‘œì‹œ
        const contentDiv = document.querySelector('.content');
        const messageDiv = document.createElement('div');
        messageDiv.className = 'error-message';
        messageDiv.innerHTML = renderMarkdown(`âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
        contentDiv.appendChild(messageDiv);
        contentDiv.scrollTop = contentDiv.scrollHeight;
      }
    });

    // === ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê¸°ëŠ¥ ===
    const contentArea = document.getElementById('content-area');
    
    // ë“œë˜ê·¸ ì˜¤ë²„ ìŠ¤íƒ€ì¼
    contentArea.addEventListener('dragover', function(e) {
      e.preventDefault();
      if (isEditMode) return;
      contentArea.style.backgroundColor = '#f0f8ff';
      contentArea.style.border = '2px dashed #4CAF50';
    });
    
    contentArea.addEventListener('dragleave', function(e) {
      e.preventDefault();
      contentArea.style.backgroundColor = '';
      contentArea.style.border = '';
    });
    
    // íŒŒì¼ ë“œë¡­ ì²˜ë¦¬
    contentArea.addEventListener('drop', async function(e) {
      e.preventDefault();
      if (isEditMode) return;
      
      contentArea.style.backgroundColor = '';
      contentArea.style.border = '';
      
      const files = Array.from(e.dataTransfer.files);
      const supportedExtensions = ['.pdf', '.txt', '.docx', '.md'];
      
      for (const file of files) {
        const extension = '.' + file.name.split('.').pop().toLowerCase();
        
        if (!supportedExtensions.includes(extension)) {
          const messageDiv = document.createElement('div');
          messageDiv.className = 'error-message';
          messageDiv.innerHTML = renderMarkdown(`âŒ ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹: ${file.name}`);
          contentArea.appendChild(messageDiv);
          continue;
        }
        
        // ì—…ë¡œë“œ ì§„í–‰ ë©”ì‹œì§€ í‘œì‹œ
        const progressDiv = document.createElement('div');
        progressDiv.className = 'success-message';
        progressDiv.innerHTML = renderMarkdown(`ğŸ“ ì—…ë¡œë“œ ì¤‘: ${file.name}...`);
        contentArea.appendChild(progressDiv);
        contentArea.scrollTop = contentArea.scrollHeight;
        
        try {
          const formData = new FormData();
          formData.append('file', file);
          
          const response = await fetch('/admin/upload-document', {
            method: 'POST',
            body: formData
          });
          
          const result = await response.json();
          
          // ì§„í–‰ ë©”ì‹œì§€ ì œê±°
          progressDiv.remove();
          
          if (result.success) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'success-message';
            messageDiv.innerHTML = renderMarkdown(`âœ… ${result.message}`);
            contentArea.appendChild(messageDiv);
          } else {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'error-message';
            messageDiv.innerHTML = renderMarkdown(`âŒ ${file.name} ì—…ë¡œë“œ ì‹¤íŒ¨: ${result.message}`);
            contentArea.appendChild(messageDiv);
          }
          
        } catch (error) {
          progressDiv.remove();
          const messageDiv = document.createElement('div');
          messageDiv.className = 'error-message';
          messageDiv.innerHTML = renderMarkdown(`âŒ ${file.name} ì—…ë¡œë“œ ì˜¤ë¥˜: ${error.message}`);
          contentArea.appendChild(messageDiv);
        }
        
        contentArea.scrollTop = contentArea.scrollHeight;
      }
    });
  </script>
</body>
</html>